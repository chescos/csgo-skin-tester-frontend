<!DOCTYPE html>
<html lang="en">
<head>
  <title>CS:GO Skin Tester</title>
  <meta name="description"
        content="Test any CS:GO skin in-game on a CS:GO community server. You can equip the skin, walk around with it, and inspect it in the actual game environment."/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.4.6/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.min.js"></script>

  <style>
    [v-cloak] {
      display: none;
    }

    .fade-enter-active, .fade-leave-active {
      transition: opacity .5s;
    }

    .fade-enter, .fade-leave-to {
      opacity: 0;
    }

    .loader {
      border-top-color: transparent;
      -webkit-animation: spinner 0.8s linear infinite;
      animation: spinner 0.8s linear infinite;
    }

    @-webkit-keyframes spinner {
      0% {
        -webkit-transform: rotate(0deg);
      }
      100% {
        -webkit-transform: rotate(360deg);
      }
    }

    @keyframes spinner {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body class="bg-gray-900 text-white">
<div id="app" v-cloak>
  <div class="absolute top-0 right-0 flex justify-start items-center text-gray-500 p-4">
    <a class="block flex items-center hover:text-white mr-5" href="https://github.com/chescos/csgo-skin-tester-frontend"
       target="_blank">
      <svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title>
        <path
          d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path>
      </svg>
      <span class="ml-2">GitHub</span>
    </a>
    <a class="block flex items-center hover:text-white" href="https://chrome.google.com/webstore/detail/csgo-skin-tester/fmljflfbojphpnbijaceeemjapgkefin"
       target="_blank">
      <svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 305 305"><title>Extension</title>
        <path d="M95.506 152.511c0 31.426 25.567 56.991 56.994 56.991 31.425 0 56.99-25.566 56.99-56.991 0-31.426-25.565-56.993-56.99-56.993-31.427 0-56.994 25.567-56.994 56.993z"/>
        <path d="M283.733 77.281a2.5 2.5 0 00-.023-2.513c-13.275-22.358-32.167-41.086-54.633-54.159C205.922 7.134 179.441.012 152.5.012c-46.625 0-90.077 20.924-119.215 57.407a2.497 2.497 0 00-.212 2.81l42.93 74.355a2.5 2.5 0 004.586-.625c8.465-32.799 38.036-55.706 71.911-55.706 2.102 0 4.273.096 6.455.282.071.007.143.01.214.01H281.56c.899 0 1.729-.482 2.173-1.264z"/>
        <path d="M175.035 224.936a2.496 2.496 0 00-2.646-.876 74.14 74.14 0 01-19.889 2.709c-28.641 0-55.038-16.798-67.251-42.794a2.797 2.797 0 00-.098-.188L23.911 77.719a2.496 2.496 0 00-2.165-1.25h-.013a2.5 2.5 0 00-2.165 1.272C6.767 100.456 0 126.311 0 152.511c0 36.755 13.26 72.258 37.337 99.969 23.838 27.435 56.656 45.49 92.411 50.84a2.502 2.502 0 002.535-1.223l42.941-74.378c.508-.88.433-1.98-.189-2.783z"/>
        <path d="M292.175 95.226h-85.974a2.499 2.499 0 00-1.75 4.285c14.385 14.102 22.307 32.924 22.307 53 0 15.198-4.586 29.824-13.263 42.298a2.53 2.53 0 00-.112.178l-61.346 106.252a2.5 2.5 0 002.165 3.75h.028c40.37-.45 78.253-16.511 106.669-45.222C289.338 231.032 305 192.941 305 152.511c0-19.217-3.532-37.956-10.498-55.698a2.5 2.5 0 00-2.327-1.587z"/>
      </svg>
      <span class="ml-2">Extension</span>
    </a>
  </div>

  <div class="flex h-screen">
    <div class="m-auto w-full max-w-lg">
      <form class="bg-gray-800 shadow-md rounded p-12">
        <div class="mb-4">
          <label class="block text-sm font-bold mb-2" for="inspect_link">
            Inspect Link
          </label>
          <input v-model="link"
                 class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                 id="inspect_link" type="text" placeholder="Paste your inspect link here...">
        </div>
        <div class="flex items-center justify-between">
          <button v-on:click="inspectLink"
                  v-bind:class="{ 'cursor-not-allowed opacity-50': isLoading }"
                  class="inline-flex items-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                  type="button" :disabled="isLoading">

            <div v-if="isLoading" class="loader ease-linear rounded-full border-2 border-gray-200 h-4 w-4 mr-3"></div>
            <span>Test Skin In-Game</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <transition name="fade">
    <div v-if="notification !== null"
         v-bind:class="{ 'bg-blue-800 border-blue-500': !notification.isError, 'bg-red-800 border-red-500': notification.isError }"
         class="absolute bottom-0 left-0 right-0 border-t-4 rounded-b text-white px-4 py-3 shadow-md"
         role="alert">
      <div class="flex">
        <div class="py-1">
          <svg class="fill-current h-6 w-6 text-white mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path
              d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"/>
          </svg>
        </div>
        <div>
          <p class="font-bold">{{ notification.title }}</p>
          <p class="text-sm">{{ notification.message }}</p>
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  const app = new Vue({
    el: '#app',
    data: {
      link: '',
      notification: null,
      isLoading: false,
    },
    methods: {
      inspectLink: function (event) {
        if (this.isLoading) {
          return;
        }

        this.clearNotification();

        const inspectLinkRegex = /^steam:\/\/rungame\/730\/(?:[0-9]+)\/\+csgo_econ_action_preview/;

        if (!inspectLinkRegex.test(this.link)) {
          this.createNotification(
            'Invalid Inspect Link',
            'Please enter a valid CS:GO inspect link.',
            true,
          );

          return;
        }

        this.isLoading = true;

        fetch('https://api.csgoskins.gg/tests/link', {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            link: this.link,
          }),
        })
          .then((res) => res.json())
          .then((res) => {
            console.log(res);
            this.isLoading = false;

            if (res.success) {
              if (res.needs_to_connect) {
                window.location = res.connect_to_url;

                this.createNotification(
                  'Skin Sent',
                  'The skin has been sent to the CS:GO test server, please connect.',
                  false,
                );
              } else {
                this.createNotification(
                  'Skin Equipped',
                  'You have been equipped with the selected skin in the CS:GO test server.',
                  false,
                );
              }
            } else {
              this.createNotification(
                'Request Failed',
                res.message,
                true,
              );
            }
          })
          .catch((error) => {
            console.log(error);
            this.isLoading = false;

            this.createNotification(
              'Request Failed',
              'Something went wrong, please try again.',
              true,
            );
          });
      },

      createNotification(title, message, isError = false) {
        this.clearNotification();

        this.$nextTick(() => {
          this.notification = {
            title,
            message,
            isError,
          };
        });
      },

      clearNotification() {
        this.notification = null;
      },
    }
  })
</script>
</body>
</html>
